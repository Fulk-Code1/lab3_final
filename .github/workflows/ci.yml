  name: CI/CD

  on:
    push:
      branches: [ main, master ]
    pull_request:

  jobs:
    test:
      runs-on: ubuntu-latest

      # Запускаем наш angle-service как background-сервис
      services:
        angle-service:
          image: python:3.11-slim
          ports:
            - 8000:8000
          volumes:
            - ./angle-service:/app
          # ← только разрешённые ключи для services
          options: --workdir /app

      steps:
        - uses: actions/checkout@v4

        - name: Setup Python
          uses: actions/setup-python@v4
          with:
            python-version: '3.11'

        - name: Install pytest & requests
          run: pip install pytest requests

        - name: Wait and run tests
          run: |
            sleep 4
            pytest -v angle-service/test_angle.py